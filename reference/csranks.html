<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Confidence sets for ranks — csranks • csranks</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Confidence sets for ranks — csranks"><meta property="og:description" content="Marginal and simultaneous confidence sets for ranks."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2631182-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2631182-3');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">csranks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Inference-for-Ranks.html">Inference for Ranks</a>
    </li>
    <li>
      <a href="../articles/Rank-Rank-Reg.html">Inference for Rank-Rank Regressions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/danielwilhelm/R-CS-ranks/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Confidence sets for ranks</h1>
    <small class="dont-index">Source: <a href="https://github.com/danielwilhelm/R-CS-ranks/blob/HEAD/R/ranks.R" class="external-link"><code>R/ranks.R</code></a></small>
    <div class="hidden name"><code>csranks.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Marginal and simultaneous confidence sets for ranks.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">csranks</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">Sigma</span>,</span>
<span>  coverage <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  cstype <span class="op">=</span> <span class="st">"two-sided"</span>,</span>
<span>  stepdown <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  simul <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  indices <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>vector of estimates containing estimated features by which the <code>length</code> populations are to be ranked.</p></dd>


<dt>Sigma</dt>
<dd><p>estimated covariance matrix of <code>x</code>.</p></dd>


<dt>coverage</dt>
<dd><p>nominal coverage of the confidence set. Default is 0.95.</p></dd>


<dt>cstype</dt>
<dd><p>type of confidence set (<code>two-sided</code>, <code>upper</code>, <code>lower</code>). Default is <code>two-sided</code>.</p></dd>


<dt>stepdown</dt>
<dd><p>logical; if <code>TRUE</code> (default), stepwise procedure is used, otherwise single step procedure is used. See Details section for more.</p></dd>


<dt>R</dt>
<dd><p>number of bootstrap replications. Default is 1000.</p></dd>


<dt>simul</dt>
<dd><p>logical; if <code>TRUE</code> (default), then simultaneous confidence sets are computed, which jointly cover all populations indicated by <code>indices</code>.
Otherwise, for each population indicated in <code>indices</code> a marginal confidence set is computed.</p></dd>


<dt>indices</dt>
<dd><p>vector of indices of <code>x</code> for whose ranks the confidence sets are computed. <code>indices=NA</code> (default) means computation of confidence sets for all populations.</p></dd>


<dt>na.rm</dt>
<dd><p>logical; if <code>TRUE</code>, then <code>NA</code>'s are removed from <code>x</code> and <code>Sigma</code> (if any).</p></dd>


<dt>seed</dt>
<dd><p>seed for bootstrap random variable draws. If set to <code>NA</code> (default), then seed is not set.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>csranks</code> object, which is a list with three items:</p><dl><dt><code>L</code></dt>
<dd><p>Lower bounds of the confidence sets for ranks indicated in <code>indices</code></p></dd>

<dt><code>rank</code></dt>
<dd><p>Estimated ranks from <code><a href="irank.html">irank</a></code> with default parameters</p></dd>

<dt><code>U</code></dt>
<dd><p>Upper bounds of the confidence sets.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p>Suppose \(j=1,\ldots,p\) populations (e.g., schools, hospitals, political parties, countries) are to be ranked according to
some measure \(\theta=(\theta_1,\ldots,\theta_p)\). We do not observe the true values \(\theta_1,\ldots,\theta_p\). Instead, for each population,
we have data from which we have estimated these measures, \(\hat{\theta}=(\hat{\theta}_1,\ldots,\hat{\theta}_p)\). The values \(\hat{\theta}_1,\ldots,\hat{\theta}_p\)
are estimates of the true values \(\theta_1,\ldots,\theta_p\) and thus contain statistical uncertainty. In consequence, a ranking of the populations by
the values \(\hat{\theta}_1,\ldots,\hat{\theta}_p\) contains statistical uncertainty and is not necessarily equal to the true ranking of \(\theta_1,\ldots,\theta_p\).</p>
<p>The function computes confidence sets for the rank of one, several or all of the populations (<code>indices</code> indicates which of the \(1,\ldots,p\) populations are of interest). <code>x</code> is a vector containing the estimates
\(\hat{\theta}_1,\ldots,\hat{\theta}_p\) and <code>Sigma</code> is an estimate of the covariance matrix of <code>x</code>. The method assumes that the estimates are asymptotically normal and the sample sizes of the datasets
are large enough so that \(\hat{\theta}-\theta\) is approximately distributed as \(N(0,\Sigma)\). The argument <code>Sigma</code> should contain an estimate of the covariance matrix \(\Sigma\). For instance, if for each population \(j\)
$$\sqrt{n_j} (\hat{\theta}_j-\theta_j) \to_d N(0, \sigma_j^2)$$
and the datasets for each population are drawn independently of each other, then <code>Sigma</code> is a diagonal matrix $$diag(\hat{\sigma}_1^2/n_1,\ldots,\hat{\sigma}_p^2/n_p)$$
containing estimates of the asymptotic variances divided by the sample size. More generally, the estimates in <code>x</code> may be dependent, but then <code>Sigma</code>
must be an estimate of its covariance matrix including off-diagonal terms.</p>
<p>Marginal confidence sets (<code>simul=FALSE</code>) are such that the confidence set for a population \(j\) contains the true rank of that population \(j\) with probability approximately
equal to the nominal coverage level. Simultaneous confidence sets (<code>simul=TRUE</code>) on the other hand are such that the confidence sets for populations indicated in <code>indices</code> cover the true ranks
of all of these populations simultaneously with probability approximately equal to the nominal coverage level. For instance, in the PISA example below, a marginal confidence set of a country \(j\) covers the true
rank of country \(j\) with probability approximately equal to 0.95. A simultaneous confidence set for all countries covers the true ranks of all countries simultaneously with probability approximately equal to 0.95.</p>
<p>The function implements the procedures developed and described in more detail in Mogstad, Romano, Shaikh, and Wilhelm (2023). The procedure is based on
on testing a large family of hypotheses for pairwise comparisons. Stepwise methods can be used to improve the power of the procedure by, potentially,
rejecting more hypotheses without violating the desired coverage property of the resulting confidence set. These are employed when
<code>stepdown=TRUE</code>. From a practical point of view, <code>stepdown=TRUE</code> is computationally more demanding, but often results
in tighter confidence sets.</p>
<p>The procedure uses a parametric bootstrap procedure based on the above approximate multivariate normal distribution.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Mogstad, Romano, Shaikh, and Wilhelm (2023), "Inference for Ranks with Applications to Mobility across Neighborhoods and Academic Achievements across Countries", forthcoming at Review of Economic Studies
<a href="http://dwilhelm.userweb.mwn.de/papers/cwp0323.pdf" class="external-link">cemmap working paper</a>
<a href="https://doi.org/10.1093/restud/rdad006" class="external-link">doi:10.1093/restud/rdad006</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># simple simulated example:</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span>,<span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="va">p</span>, ncol<span class="op">=</span><span class="va">p</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">thetahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Sigmahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span></span>
<span class="r-in"><span><span class="fu">csranks</span><span class="op">(</span><span class="va">thetahat</span>, <span class="va">Sigmahat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 5 4 4 2 4 2 2 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $rank</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 10  8  9  4  7  5  6  2  3  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 10 10 10  9 10 10 10  6  6  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "csranks"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># PISA example:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">math_cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">math_se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># marginal confidence set for each country:</span></span></span>
<span class="r-in"><span><span class="fu">csranks</span><span class="op">(</span><span class="va">math_score</span>, <span class="va">math_cov_mat</span>, simul<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 15 10  5  4 35 37 10  5  1  5 12 10 32 25 12 10 32 19  1  1 12 25 25 35  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 12 10  2 12 20  5 25  7  2 32  8 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $rank</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 24 18 10  7 35 37 17  8  3 11 20 15 34 30 21 16 32 25  1  2 19 29 27 36  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 22 14  5 23 26  9 28 12  6 33 13 31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 26 24 18 12 36 37 24 14  6 18 26 24 34 31 26 24 34 31  4  6 25 31 31 36  7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 23 11 26 31 14 31 23 11 34 23 31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "csranks"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simultaneous confidence set for all countries:</span></span></span>
<span class="r-in"><span><span class="fu">csranks</span><span class="op">(</span><span class="va">math_score</span>, <span class="va">math_cov_mat</span>, simul<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $L</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 12  7  4  3 35 37  7  4  1  4 12  7 32 23 12  8 31 15  1  1 12 23 23 35  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 12  7  1 12 18  4 24  5  1 32  6 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $rank</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 24 18 10  7 35 37 17  8  3 11 20 15 34 30 21 16 32 25  1  2 19 29 27 36  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 22 14  5 23 26  9 28 12  6 33 13 31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 30 26 18 17 36 37 25 18  6 18 26 25 34 31 26 25 34 31  6  7 26 31 31 36 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 26 24 12 31 31 18 31 24 13 34 24 32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"class")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "csranks"</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://www.ucl.ac.uk/~uctpdwi/" class="external-link">Daniel Wilhelm</a>, Pawel Morgen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

