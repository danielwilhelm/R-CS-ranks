<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • csranks</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="csranks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-2631182-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2631182-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">csranks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/danielwilhelm/R-CS-ranks/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/danielwilhelm/R-CS-ranks/blob/HEAD/vignettes/Introduction.Rmd" class="external-link"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introductory-example">Introductory example<a class="anchor" aria-label="anchor" href="#introductory-example"></a>
</h2>
<p>Suppose, that you would like to learn about quality of education
across different countries. You could come up with a test, conduct it in
different countries, and calculate mean results (say, percentages of
correct answers). However, you are not interested in the mean results
themselves, but in <strong>ranking</strong> countries according to the
quality of offered education. You want to answer questions like:</p>
<ul>
<li><em>Which country has the best education?</em></li>
<li><em>How many countries have a better education system than
mine?</em></li>
<li><em>How good are education systems in the countries of my
region?</em></li>
</ul>
<p>Observe, that none of those questions is about the absolute values of
test results, but about the order of them.</p>
<p>Now, because the tests were not distributed to every single pupil in
every country, but to randomly selected sample of pupils, the obtained
mean result is not the mean result of the whole country. There is
<strong>uncertainty</strong> connected with those results (usually in a
form of standard deviation). Now, this uncertainty may influence the
positions of countries in the ranking. For example, if the first place
is tightly contested, the actual best country might not be the country
with highest mean obtained result, but the one with the second, third,
fourth…</p>
<p>Naturally, this is a problem, that occurs not only when ranking
countries’ education systems according to test results, but when ranking
any <em>populations</em> (could be counties in the USA, universities in
Germany or political parties in Australia) according to any
<em>feature</em> of interest (like social mobility, staff-to-student
ratio, or public support).</p>
</div>
<div class="section level2">
<h2 id="csranks-package">csranks package<a class="anchor" aria-label="anchor" href="#csranks-package"></a>
</h2>
<p><code>csranks</code> is an R-package that addresses uncertainty of
estimates of features used to rank populations. It does so by returning
not single ranks, but <strong>confidence sets</strong> of ranks. Those
confidence sets come in three kinds:</p>
<ul>
<li>
<em><span class="math inline">\(\tau\)</span>-best (worst)
ranks</em>. With high confidence, these contain populations, that are
among the top (bottom) <span class="math inline">\(\tau\)</span> ones.
That could be an answer to question <em>Which country has the best
education?</em> (in this case <span class="math inline">\(\tau =
1\)</span>).</li>
<li>
<em>marginal populations ranks</em>. With high confidence, those
contain ranks, that a certain population has (individually). A
<em>left-sided</em> marginal confidence set could answer a question
<em>How many countries have a better education system than
mine?</em>.</li>
<li>
<em>simultaneous populations ranks</em>. With high confidence, those
contain ranks, that certain populations have (jointly). Such a
confidence set could answer a question <em>How good are education
systems in the countries of my region?</em>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="example-continued-in-r">Example continued in R<a class="anchor" aria-label="anchor" href="#example-continued-in-r"></a>
</h2>
<p>We return to ranking countries by quality of their education systems,
according to performance in a given test. PISA study does exactly that:
conducts the same set of tests (in mathematics, reading and natural
sciences) across countries and publishes mean results along with their
standard deviations. The simplified dataset is available in package
<code>csranks</code>.</p>
<p>First, load the package <code>csranks</code>. Second, load the data
and take a quick look at it:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/danielwilhelm/R-CS-ranks" class="external-link">csranks</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">)</span></span>
<span><span class="co">#&gt;   jurisdiction science_score science_se reading_score reading_se math_score</span></span>
<span><span class="co">#&gt; 1    Australia      502.9646   1.795398      502.6317   1.634343   491.3600</span></span>
<span><span class="co">#&gt; 2      Austria      489.7804   2.777395      484.3926   2.697472   498.9423</span></span>
<span><span class="co">#&gt; 3      Belgium      498.7731   2.229240      492.8644   2.321973   508.0703</span></span>
<span><span class="co">#&gt; 4       Canada      517.9977   2.153651      520.0855   1.799716   512.0169</span></span>
<span><span class="co">#&gt; 5        Chile      443.5826   2.415280      452.2726   2.643766   417.4066</span></span>
<span><span class="co">#&gt; 6     Colombia      413.3230   3.052402      412.2951   3.251344   390.9323</span></span>
<span><span class="co">#&gt;    math_se</span></span>
<span><span class="co">#&gt; 1 1.939833</span></span>
<span><span class="co">#&gt; 2 2.970999</span></span>
<span><span class="co">#&gt; 3 2.262662</span></span>
<span><span class="co">#&gt; 4 2.357476</span></span>
<span><span class="co">#&gt; 5 2.415888</span></span>
<span><span class="co">#&gt; 6 2.989559</span></span></code></pre></div>
<p>Consider ranking countries according to their students’ achievement
in mathematics. The scores in <code>math_score</code> are estimates of
these achievements. The countries’ ranks can be estimated using the
function <code><a href="../reference/irank.html">irank()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">math_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/irank.html">irank</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_score</span><span class="op">)</span></span>
<span><span class="va">math_rank</span></span>
<span><span class="co">#&gt;  [1] 24 18 10  7 35 37 17  8  3 11 20 15 34 30 21 16 32 25  1  2 19 29 27 36  4</span></span>
<span><span class="co">#&gt; [26] 22 14  5 23 26  9 28 12  6 33 13 31</span></span></code></pre></div>
<p><code>csranks</code> package is prepared to handle populations, for
whom feature values are correlated. It thus expects a <em>covariance
matrix</em> of estimates. In our case we assume no correlations, so the
covariance matrix is diagonal:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">math_Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="best-populations">Best populations<a class="anchor" aria-label="anchor" href="#best-populations"></a>
</h3>
<p>First, we want to find out, which countries score highest (among top
5) in math. One can find it out using <code>cstaubest</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CS_5best</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cstaubest.html">cstaubest</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_score</span>, <span class="va">math_Sigma</span>, tau <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pisa</span><span class="op">[</span><span class="va">CS_5best</span>, <span class="st">"jurisdiction"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] Belgium     Canada      Denmark     Estonia     Finland     Japan      </span></span>
<span><span class="co">#&gt;  [7] Korea       Netherlands Poland      Slovenia    Sweden      Switzerland</span></span>
<span><span class="co">#&gt; 37 Levels: Australia Austria Belgium Canada Chile Colombia ... United States</span></span></code></pre></div>
<p>We have 12 countries among top 5 countries. That’s due to the
uncertainty in the data: countries lower in estimated ranking might be
among <em>true</em> top 5 countries after all. By construction, this set
contains all countries, that are among the <em>true</em> top 5 (with
high confidence) - which naturally means, that it contains more than 5
to not exclude a certain country among the true top 5 by mistake.</p>
<p>This confidence in including in the resulting set every population
that should be there is called <strong>controlling the type I
error</strong> in statistics. In package it’s referred to as
<strong>coverage</strong>, since the resulting confidence set
<em>covers</em> the true top 5 countries with a certain, high
probability. The standard value of this probability is 95%. One can get
smaller sets, if wishes to sacrifice some confidence in return.</p>
<p>Here is a smaller set answering the same question, but with lower
confidence:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CS_5best_90</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cstaubest.html">cstaubest</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_score</span>, <span class="va">math_Sigma</span>, tau <span class="op">=</span> <span class="fl">5</span>, coverage <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pisa</span><span class="op">[</span><span class="va">CS_5best_90</span>, <span class="st">"jurisdiction"</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] Belgium     Canada      Denmark     Estonia     Finland     Japan      </span></span>
<span><span class="co">#&gt;  [7] Korea       Netherlands Poland      Slovenia    Switzerland</span></span>
<span><span class="co">#&gt; 37 Levels: Australia Austria Belgium Canada Chile Colombia ... United States</span></span></code></pre></div>
<p>The country of Sweden has been excluded; the rest remained in the
set.</p>
</div>
<div class="section level3">
<h3 id="marginal-confidence-sets">Marginal Confidence Sets<a class="anchor" aria-label="anchor" href="#marginal-confidence-sets"></a>
</h3>
<p>Now we would like to know more about a single country of interest -
for example, the United Kingdom. We want to know, what’s its position in
ranking according to math scores.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uk_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">jurisdiction</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span></span>
<span><span class="va">CS_marg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csranks.html">csranks</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_score</span>, <span class="va">math_Sigma</span>, simul<span class="op">=</span><span class="cn">FALSE</span>, indices <span class="op">=</span> <span class="va">uk_i</span><span class="op">)</span></span>
<span><span class="va">CS_marg</span></span>
<span><span class="co">#&gt; $L</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rank</span></span>
<span><span class="co">#&gt; [1] 13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $U</span></span>
<span><span class="co">#&gt; [1] 23</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "csranks"</span></span></code></pre></div>
<p>Based only on the estimates of mean test scores, we would assign the
UK 13th position in the ranking. However, due to uncertainty of results,
its <em>true</em> position could be as high as 8 and as low as 23. This
weakens any inference and decisions done based on this ranking. It turns
out, that the PISA score in math for the UK is not so informative.</p>
<p>Several governments have set national performance targets based on
how well the country ranks in the league table. Incorporating the
uncertainty of position in the league table could lead to a change of
approach to the ranking and of policies based on it.</p>
</div>
<div class="section level3">
<h3 id="simultaneous-confidence-of-sets">Simultaneous confidence of sets<a class="anchor" aria-label="anchor" href="#simultaneous-confidence-of-sets"></a>
</h3>
<p>Finally, we would like to get a general overview of ranking of
education systems. For that, we can use a simultaneous confidence set
for ranks of all populations. This is also a good moment to present the
<code>plot</code> method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CS_simul</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/csranks.html">csranks</a></span><span class="op">(</span><span class="va">pisa</span><span class="op">$</span><span class="va">math_score</span>, <span class="va">math_Sigma</span>, simul<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">CS_simul</span>, popnames<span class="op">=</span><span class="va">pisa</span><span class="op">$</span><span class="va">jurisdiction</span>, </span>
<span>     title<span class="op">=</span><span class="st">"Ranking of OECD Countries by 2018 PISA Math Score"</span>, </span>
<span>     subtitle<span class="op">=</span><span class="st">"(with 95% simultaneous confidence sets)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/math_simul-1.png" width="672"></p>
<p>We can draw a variety of conclusions. The confidence sets for
countries at the top and bottom are tighter than for those in the
middle. This means, that the countries at the top are truly at the top
(there is significant difference between them and the rest), while the
countries in the middle are fairly similar.</p>
<p>This plot also reaffirms results from previous chunks. Indeed,
Sweden’s confidence set border is 5. Changing the confidence level
tightened the set and one could no longer say, that Sweden might be
among top 5 countries. For the 11 countries above, the sets started at
at least 4th rank, so they all could possibly be among the <em>true</em>
top 5 countries.</p>
<p>The confidence set for UK here is larger, than the marginal set
obtained in previous chunk. This is, because the simultaneous sets must
cover all true ranks for all populations of interest at once, while the
marginal - only for one population. Thus, with the same level of general
confidence, the marginal sets have to account for less possibilities of
errors and are tighter than simultaneous ones.</p>
</div>
</div>
<div class="section level2">
<h2 id="further-reading-and-references">Further reading and references<a class="anchor" aria-label="anchor" href="#further-reading-and-references"></a>
</h2>
<p>This package is based on paper Mogstad, Romano, Shaikh, and Wilhelm
(2023), “Inference for Ranks with Applications to Mobility across
Neighborhoods and Academic Achievements across Countries”, forthcoming
at Review of Economic Studies. It is available in <a href="http://dwilhelm.userweb.mwn.de/papers/cwp0323.pdf" class="external-link">pdf format</a>
and it’s DOI is <a href="https://doi.org/10.1093/restud/rdad006" class="external-link">10.1093/restud/rdad006</a>.</p>
<p>Check out the documentation of individual functions at package’s <a href="https://danielwilhelm.github.io/R-CS-ranks/" class="external-link">website</a>, as well
as further examples at package’s <a href="https://github.com/danielwilhelm/R-CS-ranks/tree/master/examples" class="external-link">Github</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://www.ucl.ac.uk/~uctpdwi/" class="external-link">Daniel Wilhelm</a>, Pawel Morgen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
